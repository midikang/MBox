# SpeedMobile - 截图整理助手

一个微信小程序，用于解决手机截图过多占用空间、手机屏幕太小不便整理的痛点。支持手机端批量上传、电脑端浏览下载，并实现双端同步删除。

## 功能特点

### 1. 批量上传截图
- 从手机相册批量选择截图（最多20张）
- 快速上传到服务器
- 实时显示上传进度

### 2. 电脑端浏览下载
- 在电脑浏览器打开小程序
- 网格方式浏览所有截图
- 支持预览和下载到本地

### 3. 双端同步删除
- 电脑端删除照片
- 自动同步到服务器
- 手机端实时更新，释放存储空间

## 项目结构

```
SpeedMobile/
├── mp/              # 微信小程序前端
│   ├── app.js       # 小程序入口
│   ├── app.json     # 小程序配置
│   ├── app.wxss     # 全局样式
│   ├── sitemap.json # 站点地图
│   └── pages/       # 页面
│       ├── index/   # 主页（图片列表）
│       │   ├── index.js
│       │   ├── index.wxml
│       │   ├── index.wxss
│       │   └── index.json
│       └── upload/  # 上传页面
│           ├── upload.js
│           ├── upload.wxml
│           ├── upload.wxss
│           └── upload.json
│   └── config.js    # 配置文件（环境配置）
└── api/             # 后端API服务
    ├── server.js    # Express服务器
    ├── package.json # 依赖配置
    └── .gitignore   # Git忽略配置
```

## 快速开始

### 后端服务

1. 安装依赖：
```bash
cd SpeedMobile/api
npm install
```

2. 启动服务器：
```bash
npm start
```

服务器将在 `http://localhost:3000` 运行

开发模式（自动重启）：
```bash
npm run dev
```

### 微信小程序

1. 使用微信开发者工具打开 `SpeedMobile/mp` 目录

2. 配置服务器地址：
   - 编辑 `config.js` 文件
   - 开发环境：`env = 'development'`，使用 `http://localhost:3000`
   - 生产环境：`env = 'production'`，需要配置 HTTPS 域名

3. 编译运行小程序

## API 接口

### 1. 上传图片
```
POST /api/upload
Content-Type: multipart/form-data

参数：
- image: 图片文件

响应：
{
  "success": true,
  "message": "上传成功",
  "image": {
    "id": "...",
    "filename": "...",
    "url": "/uploads/...",
    "size": 12345,
    "uploadDate": "2026-02-03T23:36:41.210Z"
  }
}
```

### 2. 获取图片列表
```
GET /api/images

响应：
{
  "success": true,
  "images": [
    {
      "id": "...",
      "filename": "...",
      "url": "/uploads/...",
      "size": 12345,
      "uploadDate": "2026/2/3"
    }
  ]
}
```

### 3. 删除单张图片
```
DELETE /api/images/:id

响应：
{
  "success": true,
  "message": "删除成功"
}
```

### 4. 批量删除图片
```
POST /api/images/batch-delete
Content-Type: application/json

参数：
{
  "ids": ["id1", "id2", ...]
}

响应：
{
  "success": true,
  "message": "成功删除 N 张图片",
  "deletedCount": N
}
```

### 5. 健康检查
```
GET /api/health

响应：
{
  "success": true,
  "message": "API服务正常运行",
  "timestamp": "2026-02-03T23:36:41.210Z"
}
```

## 使用说明

### 手机端操作

1. **上传截图**
   - 点击"上传截图"按钮
   - 从相册选择要上传的截图（最多20张）
   - 点击"上传"按钮
   - 等待上传完成

2. **查看截图**
   - 主页显示所有已上传的截图
   - 下拉刷新更新列表
   - 点击图片可预览

3. **删除截图**
   - 点击图片左上角的复选框选择
   - 点击"删除选中"按钮
   - 确认删除
   - **注意**：仅删除服务器上的副本，不会删除手机相册中的原始截图

### 电脑端操作

1. **浏览截图**
   - 在电脑浏览器打开微信小程序
   - 查看所有上传的截图

2. **下载截图**
   - 点击图片下方的"下载"按钮
   - 图片保存到本地

3. **批量删除**
   - 选择多张图片
   - 点击"删除选中"按钮
   - 手机端会自动同步删除
   - **注意**：仅删除服务器上的副本，不会删除手机相册中的原始截图

## 重要说明

### 关于删除功能

- **删除范围**：删除操作只会删除服务器上存储的图片副本
- **手机相册**：不会删除手机相册中的原始截图
- **释放空间**：如需释放手机存储空间，请在上传后手动到手机相册删除原始截图
- **权限说明**：微信小程序只有读取和保存相册的权限，无法删除相册中的照片

### 推荐使用流程

1. 从手机相册选择截图并上传到服务器
2. 确认上传成功后，手动删除手机相册中的原始截图以释放空间
3. 需要时在小程序中浏览或下载之前上传的截图
4. 不再需要的截图可以在小程序中删除（删除服务器副本）

## 技术栈

- **前端**: 微信小程序 (WXML, WXSS, JavaScript)
- **后端**: Node.js + Express
- **文件上传**: Multer
- **数据存储**: JSON 文件 (简单实现，生产环境建议使用数据库)

## 注意事项

1. **服务器配置**
   - 生产环境需要配置 HTTPS
   - 微信小程序要求服务器必须使用 HTTPS
   - **重要**: 生产环境必须添加速率限制（rate limiting）防止API滥用

2. **域名配置**
   - 在微信公众平台配置服务器域名白名单
   - 配置 request 合法域名
   - 配置 uploadFile 合法域名
   - 配置 downloadFile 合法域名

3. **存储限制**
   - 当前实现使用文件系统存储
   - 生产环境建议使用云存储服务（如腾讯云COS、阿里云OSS等）

4. **权限设置**
   - 需要开启相册访问权限
   - 需要开启网络访问权限

5. **依赖版本**
   - 当前使用 multer 1.x，存在已知安全漏洞
   - 生产环境建议升级到 multer 2.x

## 后续优化建议

1. **安全加固**
   - 添加 API 速率限制（如 express-rate-limit）
   - 添加用户认证和授权
   - 实现文件上传大小和类型的严格验证

2. **数据库支持**
   - 使用 MongoDB 或 MySQL 替代 JSON 文件
   - 提高查询和管理效率

3. **云存储**
   - 集成腾讯云 COS 或阿里云 OSS
   - 提高存储可靠性和访问速度

4. **用户系统**
   - 添加用户登录功能
   - 支持多用户独立空间

5. **图片处理**
   - 自动压缩图片
   - 生成缩略图
   - OCR 文字识别

6. **分类管理**
   - 支持创建文件夹
   - 按日期、类型自动分类

## 许可证

MIT License
